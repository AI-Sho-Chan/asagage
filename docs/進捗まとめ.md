# 進捗まとめ（'+$ts+'）

## 実装サマリ
- 夜間バッチ拡張: `scripts/nightly_build_candidates.py`
  - ユニバース: `--universe-mode excel|yahoo-top`、`--universe-metric amt|vol`、上位N（既定300）抽出
  - 出力: `output/excel/candidates_nextday.csv`、各RUN配下に `_COMPARE.csv`/`summary_*.xlsx`
- 並列評価: `scripts/bt_opt30_forward.py` に `--jobs` 追加、銘柄並列最適化
- ギャップ・ガード/受入れ閾値/CI: フォワード重視、Wilson区間/ブートストラップCIを付与
- NewDashboard新設: 既存Dashboardと分離、ボタン/ガード/自動起動（Auto_Open）
  - B2=AutoTrade, B3=MaxOrders, B4/B5=時間帯, B6=Selected既定, B7=日次Reentry, B8=HardStop
  - B9=Live（0=ドライラン/1=実発注）, B10=OrderMacro（既定: `MS2Bridge.Place`）, B11=Close-Out時刻
  - B12=数量, B13=TIF/Type
  - Attach RSS Formulas: 既存Dashboardの「現在値/VWAP/ATR」の式をNewDashboardへ自動コピー
- 発注ブリッジ: `excel/vba/MS2Bridge.bas`
  - `MS2_Config`シートにテンプレ（Entry/TP/SL/MOC）を格納、`{Ticker}/{Side}/{Qty}/{Price}/{TIF}/{Account}/{Market}` を置換→`Application.Evaluate`で楽天RSS関数を呼出
  - 既定テンプレはダミー文字列（PDFの関数・引数に合わせてValue列を編集すれば実行）
- クリック実行: `scripts/run_nightly_now.cmd`, `scripts/run_nightly_now_volume.cmd`, `scripts/run_scheduler_now.cmd`
- スケジューラ: `AsagakeNightlyBuild`（平日18:05）

## 運用手順（朝）
1. Excelを起動（Auto_Openで Load→Push→Start 自動実行）
2. 実発注へ切替える場合: B9=1, B10=`MS2Bridge.Place`のまま/もしくは任意マクロ、MS2_ConfigのValueをRSS関数に合わせて記入
3. ボタン: Catch Up で夜間ジョブを即時実行、AttachでRSS式をNewDashboardへコピー

## テストと切替
- テスト（推奨）: B9=0でドライラン、Ordersにログ/挙動確認→B9=1へ
- OCO: ブローカーOCOを利用する場合、MS2_ConfigのテンプレをOCO指定へ更新（PDF準拠）

## 比較検証の進捗
- amt/vol×上位300×min-forward-trades=5/8/10（AM10/AM15×j-only/j-cross）を並列実行中
- 完了後: `output/bt30/NIGHTLY_YYYYMMDD/comparison_summary.(csv|xlsx)` を出力、最適帯をレポート

## 追加済みファイル
- `excel/vba/MS2Bridge.bas`（ブリッジ）
- `excel/vba/FullAuto.bas`（ログ用の最小発注雛形。既存FullAutoがある場合はB10で切替）
- `scripts/setup_excel_dashboard.py`（NewDashboard整備/ボタン配置/MS2_Config初期化）
- 既存更新: `excel/vba/AutoTrader.bas`, `scripts/bt_opt30_forward.py`, `scripts/nightly_build_candidates.py`

## 今後やること（当方が即着手）
1) PDF(4〜24p)に基づくMS2_Configテンプレの具体化
   - RssStockOrder/RssMarginOpenOrder/RssMarginCloseOrderほかの引数順を確定
   - Entry/TP/SL/MOCを最小限で動く形でValueに記入（現物→信用の順で）
   - OCOが使える場合の指定方法をValueへ反映
2) 小数量・単一銘柄で Live=1 の検証
   - ENTRY→TP/SL→MOCまでの一連の流れをOrdersログと発注応答で確認
   - 必要ならValueの引数を即日修正
3) 比較レポートの集計/報告
   - amt/vol・閾値5/8/10・AM10/AM15・j-only/j-crossの優位性を表に整理

## 依頼事項（任意）
- MS2_Configの Account/Market の既定値が必要であれば値をご指定ください
- 既存のRSS発注関数の呼出例があれば共有ください（無くてもPDF準拠で当方が具体化します）
